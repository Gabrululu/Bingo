<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bingo Marketero</title>

  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="favicon.svg" />

  <!-- Meta sociales -->
  <meta name="description" content="Bingo Web3 interactivo para comunidades de marketing y blockchain." />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Bingo Web3 - MKT Community" />
  <meta property="og:description" content="Juega con t√©rminos de DeFi, NFT, DAO y m√°s." />
  <meta property="og:image" content="favicon.svg" />
  <meta name="theme-color" content="#0f172a" />

  <!-- Estilos base: centrado, tipograf√≠a y layout responsive -->
  <style>
    :root{
      /* Fondo */
      --bg-0:#0b0f2a; --bg-1:#101634; --bg-2:#141b3d;
      /* Texto */
      --txt-1:#eaf2ff; --txt-2:#b9c5e2; --txt-3:#8ea0c7;
      /* Marca */
      --magenta:#ff51b2; --orange:#ffb33a; --cyan:#38e0d2; --violet:#9353ff;
      /* Gradientes */
      --grad-brand: linear-gradient(135deg, var(--magenta), var(--orange), var(--cyan));
      --grad-card: linear-gradient(180deg, rgba(255,81,178,.10), rgba(56,224,210,.06));
      /* Acentos */
      --ok:#5be49b; --warn:#ffd166; --danger:#ff6b6b;
      /* Bordes/blur */
      --br:14px; --border:1px solid rgba(255,255,255,.10);
      --glass: backdrop-filter: blur(8px);
      --ring: 0 0 0 3px rgba(56,224,210,.25);
      --shadow: 0 8px 28px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
      background: radial-gradient(1200px 800px at 50% -20%, var(--bg-1), transparent 60%), var(--bg-0);
      color:var(--txt-1);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    /* Contenedor principal centrado */
    .container{
      min-height:100dvh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
    }

    /* Tarjeta central */
    .card{width:min(980px, 100%);background:var(--bg-2);border:var(--border);border-radius:var(--br);box-shadow:var(--shadow);padding:clamp(20px, 2.5vw, 28px)}

    /* Header principal */
    .header{
      text-align:center;
      margin-bottom:22px;
    }
    .community-name{font-size:.85rem;letter-spacing:.25rem;color:var(--txt-3);text-transform:uppercase;margin-bottom:8px}
    h1{
      margin:0 0 6px;
      font-size:clamp(26px, 4.6vw, 40px);
      line-height:1.1;
    }
    .subtitle{margin:0;color:var(--txt-2);font-size:clamp(14px, 2.6vw, 16px)}

    /* Layout de secciones (stack) */
    .stack{display:flex; flex-direction:column; gap:18px}

    /* Botones */
    .btn{appearance:none;border:0;cursor:pointer;padding:.8rem 1.1rem;border-radius:12px;font-weight:700;transition:.15s ease;box-shadow:var(--shadow)}
    .btn:hover{transform:translateY(-1px)}
    .btn:active{transform:translateY(0)}
    .btn:focus-visible{outline:none;box-shadow:var(--shadow), var(--ring)}
    .btn-primary{background:var(--grad-brand);color:#0b0f2a}
    .btn-primary:hover{filter:saturate(1.05)}
    .btn-danger{background:var(--danger);color:#0b0f2a}
    .btn-secondary{background:transparent;border:var(--border);color:var(--txt-1)}
    .btn-secondary:hover{background:rgba(255,255,255,.06)}
    .btn-small{padding:8px 12px; font-size:.9rem}

    /* Formularios */
    .form{
      display:grid; gap:14px;
      background:rgba(2,6,23,.45);
      border:1px solid rgba(148,163,184,.15);
      border-radius:12px; padding:16px;
    }
    .form-row{display:grid; gap:6px}
    label{font-size:.95rem; color:var(--muted)}
    input[type="email"],
    input[type="password"],
    input[type="text"]{
      width:100%; padding:12px 14px; border-radius:10px;
      border:1px solid rgba(148,163,184,.25);
      background:#0b1220; color:var(--text);
    }
    input::placeholder{color:#64748b}
    .form-actions{display:flex; gap:10px; flex-wrap:wrap}

    /* Secciones del moderador */
    .dashboard-header{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      flex-wrap:wrap; margin-bottom:12px;
    }
    .user-info{display:flex; align-items:center; gap:10px; color:var(--txt-3)}
    .rooms-actions{display:flex; gap:10px; flex-wrap:wrap; margin-bottom:8px}
    .rooms-list, .participants-list, .called-terms-list{background:var(--bg-2);border:var(--border);border-radius:var(--br);padding:12px;min-height:48px}
    .no-rooms, .no-participants{color:var(--muted); margin:6px 0}

    .room-info{display:flex; align-items:center; gap:10px; flex-wrap:wrap}
    .status-badge{
      display:inline-block; padding:6px 10px; border-radius:999px;
      background:#0b1220; border:1px solid rgba(148,163,184,.25); color:#cbd5e1; font-size:.85rem;
    }

    .share-section{display:grid; gap:10px}
    .share-link-container{
      display:flex; gap:10px; flex-wrap:wrap;
    }
    #shareLink{flex:1 1 260px; min-width:240px; background:var(--bg-0); color:var(--txt-1); border:var(--border); border-radius:10px; padding:12px 14px}
    .game-controls .control-buttons{display:flex; gap:10px; flex-wrap:wrap}

    .current-term{
      padding:12px; border-radius:12px; background:#0b1220;
      border:1px solid rgba(148,163,184,.25);
    }

    /* Participante */
    .registration-form{
      display:grid; gap:12px;
      background:rgba(2,6,23,.45);
      border:1px solid rgba(148,163,184,.15);
      border-radius:12px; padding:16px;
      max-width:520px; margin-inline:auto;
      text-align:center;
    }
    .participant-status{ 
      background:rgba(2,6,23,.45); border:1px solid rgba(148,163,184,.15);
      border-radius:12px; padding:16px; text-align:center; max-width:720px; margin:12px auto;
    }
    .participant-status.waiting{ border-color:rgba(96,165,250,.35) }
    .participant-status.assigned{ border-color:rgba(16,185,129,.35) }

    .player-card-container{max-width:780px; margin:14px auto}
    .bingo-card{display:grid; grid-template-columns:repeat(5,1fr); gap:6px}
    .bingo-card div{
      background:#0b1220; border:1px solid rgba(148,163,184,.25);
      border-radius:10px; padding:10px; text-align:center; min-height:52px;
      display:flex; align-items:center; justify-content:center; word-break:break-word;
    }

    /* Utilidades */
    .hidden{display:none !important}
    .section{background:rgba(255,255,255,.01); border-radius:12px; padding:12px}
    .divider{height:1px; background:rgba(148,163,184,.15); margin:10px 0}

    /* Responsive tweaks */
    @media (max-width: 560px){
      .form-actions{flex-direction:column}
      .dashboard-header{flex-direction:column; align-items:flex-start}
    }
    /* Bingo Card UI polish */
    .card-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:8px;width:100%;max-width:520px;margin:0 auto}
    .card-cell{aspect-ratio:1/1;border-radius:10px;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.04);display:flex;align-items:center;justify-content:center;padding:6px;transition:transform .08s ease, box-shadow .08s ease, background .08s ease;cursor:pointer;outline:none}
    .card-cell:hover,.card-cell:focus-visible{transform:translateY(-1px);box-shadow:0 4px 10px rgba(0,0,0,.25);border-color:rgba(255,255,255,.24)}
    .card-cell.marked{background:rgba(16,185,129,.25);border-color:rgba(16,185,129,.6)}
    .cell-text{font-size:clamp(10px,1.8vw,14px);line-height:1.15;text-align:center;color:#e8eef6;width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;padding:0 4px}
    @media (max-width:480px){.card-grid{gap:6px}.cell-text{font-size:12px}}
    /* Hero adjustments */
    .hero{position:relative;display:grid;place-items:center;min-height:60vh;padding-top:64px}
    .hero__inner{position:relative;text-align:center;max-width:720px;width:100%;padding:24px 16px 0;margin:0 auto}
    .hero__logo-badge{position:absolute;top:-36px;left:50%;transform:translateX(-50%);width:72px;height:72px;border-radius:50%;background:radial-gradient(closest-side, rgba(255,255,255,.18), rgba(255,255,255,.06));box-shadow:0 10px 25px rgba(0,0,0,.25);display:grid;place-items:center;z-index:2}
    .hero__branding{letter-spacing:.22em;font-weight:700;color:#41e3ff;margin-top:28px;margin-bottom:6px}
    .hero__title{font-size:clamp(32px,5.5vw,56px);line-height:1.05;margin:4px 0 6px;color:#f5ad7a}
    .hero__subtitle{color:#a9b4c5;margin:4px 0 18px;font-size:clamp(14px,2.2vw,18px)}
    .hero__cta{margin-top:12px}
    @media (max-width:480px){
      .hero{min-height:56vh;padding-top:56px}
      .hero__logo-badge{top:-28px;width:64px;height:64px}
      .hero__branding{margin-top:22px}
    }
  </style>

  <!-- Tu CSS (si lo usas) -->
  <link rel="stylesheet" href="assets/css/styles.css" />
</head>
<body>
  <div class="container">
    <main class="card stack" aria-live="polite">
      <!-- L A N D I N G -->
      <section id="landing-page" class="hero" aria-label="Inicio">
        <div class="hero__inner">
          <div class="hero__logo-badge" aria-hidden="true">
            <span style="font-size:28px;">üöÄ</span>
          </div>

          <div class="hero__branding">MKT COMMUNITY</div>
          <h1 class="hero__title">BINGO WEB3</h1>
          <p class="hero__subtitle">Marketing &amp; Blockchain Edition</p>

          <div id="moderator-cta" class="hero__cta">
            <button class="btn btn-primary" onclick="openModeratorLogin()">Acceder como Moderador</button>
          </div>
        </div>
      </section>

      <!-- A C C E S O  M O D E R A D O R -->
      <section id="moderator-login" class="hidden" aria-label="Acceso de moderador">
        <div class="form" style="max-width:520px; margin-inline:auto">
          <h2 style="margin:0 0 6px">üîê Acceso de Moderador</h2>
          <form id="loginForm" class="stack" novalidate>
            <div class="form-row">
              <label for="email">Email</label>
              <input type="email" id="email" autocomplete="username" required />
            </div>
            <div class="form-row">
              <label for="password">Contrase√±a</label>
              <input type="password" id="password" autocomplete="current-password" required />
            </div>
            <div class="form-actions">
              <button type="submit" class="btn btn-primary">Iniciar Sesi√≥n</button>
              <button type="button" id="showRegister" class="btn btn-secondary">Registrarse</button>
            </div>
          </form>
          <form id="registerForm" class="hidden stack" novalidate>
            <div class="form-row">
              <label for="regEmail">Email</label>
              <input type="email" id="regEmail" autocomplete="username" required />
            </div>
            <div class="form-row">
              <label for="regPassword">Contrase√±a</label>
              <input type="password" id="regPassword" autocomplete="new-password" required minlength="6" />
            </div>
            <div class="form-row">
              <label for="regConfirmPassword">Confirmar Contrase√±a</label>
              <input type="password" id="regConfirmPassword" autocomplete="new-password" required />
            </div>
            <div class="form-actions">
              <button type="submit" class="btn btn-primary">Registrarse</button>
              <button type="button" id="showLogin" class="btn btn-secondary">Ya tengo cuenta</button>
            </div>
          </form>
        </div>
      </section>

      <!-- D A S H B O A R D  M O D E R A D O R -->
      <section id="moderator-dashboard" class="hidden stack" aria-label="Panel de moderador">
        <div class="dashboard-header">
          <h2 style="margin:0">üéÆ Panel de Moderador</h2>
          <div class="user-info">
            <span id="moderatorName"></span>
            <button id="logoutBtn" class="btn btn-small btn-secondary">Cerrar Sesi√≥n</button>
          </div>
        </div>

        <!-- Mis salas -->
        <section id="my-rooms-section" class="stack section" aria-label="Mis salas">
          <h3 style="margin:0">üè† Mis Salas</h3>
          <div class="rooms-actions">
            <button id="createRoomBtn" class="btn btn-primary">üéØ Crear Nueva Sala</button>
            <button id="refreshRoomsBtn" class="btn btn-secondary">üîÑ Actualizar Lista</button>
          </div>
          <div id="roomsList" class="rooms-list">
            <p class="no-rooms">No tienes salas creadas</p>
          </div>
        </section>

        <!-- Gesti√≥n de sala -->
        <section id="room-management" class="hidden stack section" aria-label="Gesti√≥n de sala">
          <div class="room-info">
            <h3 style="margin:0">Sala: <span id="currentRoomCode"></span></h3>
            <span id="roomStatus" class="status-badge">Lobby</span>
            <button id="backToRoomsBtn" class="btn btn-small btn-secondary">‚Üê Volver a Mis Salas</button>
          </div>

          <div class="share-section">
            <h4 style="margin:0">üì§ Compartir Sala</h4>
            <div class="share-link-container">
              <input type="text" id="shareLink" readonly aria-label="Enlace para compartir" />
              <button id="copyLinkBtn" class="btn btn-secondary">Copiar</button>
            </div>
            <p class="subtitle">Comparte este enlace con los participantes. Ellos solo ingresan su nombre.</p>
          </div>

          <div class="participants-section stack">
            <h4 style="margin:0">üë• Participantes (<span id="participantCount">0</span>)</h4>
            <div id="participantsList" class="participants-list">
              <p class="no-participants">No hay participantes registrados</p>
            </div>
          </div>

          <div class="game-controls stack">
            <h4 style="margin:0">üéÆ Controles del Juego</h4>
            <div class="control-buttons">
              <button id="assignCardsBtn" class="btn btn-secondary">Asignar Cartillas</button>
              <button id="startGameBtn" class="btn btn-primary">Iniciar Juego</button>
              <button id="nextTermBtn" class="btn btn-secondary">Siguiente T√©rmino</button>
              <button id="resetGameBtn" class="btn btn-danger">Reiniciar Todo</button>
              <button id="deleteRoomBtn" class="btn btn-danger">Eliminar Sala</button>
            </div>
          </div>

          <div class="current-term-section stack">
            <h4 style="margin:0">üéØ T√©rmino Actual</h4>
            <div id="currentTerm" class="current-term">Registra participantes y asigna cartillas para comenzar</div>
          </div>

          <div class="called-terms-section stack">
            <h4 style="margin:0">üìã T√©rminos Mostrados</h4>
            <div class="game-stats" style="display:flex; gap:14px; color:var(--muted)">
              <span>Llamados: <strong id="termsCalledCount">0</strong></span>
              <span>Restantes: <strong id="termsRemainingCount">0</strong></span>
            </div>
            <div id="calledTermsList" class="called-terms-list"></div>
          </div>
        </section>
      </section>

      <!-- M O D O  P A R T I C I P A N T E -->
      <section id="participant-mode" class="hidden stack" aria-label="Participante">
        <div id="registration-section">
          <div class="registration-form">
            <h2 style="margin:0 0 6px">¬°√önete al Bingo Web3!</h2>
            <p class="subtitle" style="margin:0 0 12px">Ingresa tu nombre para participar</p>
            <div class="form-row">
              <label for="participantName">Tu nombre</label>
              <input type="text" id="participantName" placeholder="Ejemplo: Juan P√©rez" maxlength="40" />
            </div>
            <button class="btn btn-primary" onclick="registerParticipant()">üöÄ Registrarse</button>
          </div>
        </div>

        <div id="waiting-section" class="hidden">
          <div class="participant-status waiting">
            <h3 style="margin:0 0 6px">¬°Registrado exitosamente!</h3>
            <p class="subtitle" style="margin:0 0 8px">Esperando que el moderador asigne las cartillas‚Ä¶</p>
            <div><strong>Tu nombre:</strong> <span id="registeredName"></span></div>
          </div>
        </div>

        <div id="playing-section" class="hidden">
          <div class="participant-status assigned">
            <h3 style="margin:0 0 6px">¬°Tu cartilla est√° lista!</h3>
            <p class="subtitle" style="margin:0">Marca las casillas cuando el moderador anuncie los t√©rminos.</p>
          </div>

          <div class="player-card-container">
            <div id="playerCard" class="bingo-card"></div>

            <div style="text-align:center; margin-top:12px; padding:10px; background:#083344; border:1px solid rgba(148,163,184,.2); border-radius:10px; color:#cbd5e1">
              <strong>üí° Tip:</strong> Toca las casillas para marcarlas. Rota tu dispositivo si necesitas m√°s espacio.
            </div>
          </div>

          <div style="text-align:center; margin-top:12px">
            <button class="btn btn-success" style="background:linear-gradient(180deg,#34d399,#10b981)" onclick="claimBingo()">üéâ ¬°BINGO!</button>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Firebase SDK (modular) -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js';
    import {
      getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword,
      signInAnonymously, signOut, onAuthStateChanged,
      setPersistence, browserLocalPersistence
    } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js';
    import {
      getFirestore, collection, addDoc, doc, onSnapshot, updateDoc, setDoc,
      deleteDoc, serverTimestamp, getDocs, query, where, orderBy, getDoc
    } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js';

    const firebaseConfig = {
      apiKey: "AIzaSyCgWVgfDgYOLCXvMoI6B8cKtc1lt0E2jOc",
      authDomain: "bingo-d2f28.firebaseapp.com",
      projectId: "bingo-d2f28",
      storageBucket: "bingo-d2f28.firebasestorage.app",
      messagingSenderId: "786733165579",
      appId: "1:786733165579:web:a5339c73eaf1d31c3eeb0e",
      measurementId: "G-17C462BPND"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Persistencia del auth (mantiene UID an√≥nimo entre recargas)
    try { await setPersistence(auth, browserLocalPersistence); } catch (e) { console.warn('Auth persistence warning:', e?.message || e); }

    // Exponer para app.js
    window.firebaseAuth = auth;
    window.firebaseDb = db;
    window.firebaseCreateUserWithEmailAndPassword = createUserWithEmailAndPassword;
    window.firebaseSignInWithEmailAndPassword = signInWithEmailAndPassword;
    window.firebaseSignOut = signOut;
    window.firebaseSignInAnonymously = signInAnonymously;
    window.firebaseOnAuthStateChanged = onAuthStateChanged;
    // No exponemos setPersistence/browserLocalPersistence, se aplica arriba una vez
    window.firebaseCollection = collection;
    window.firebaseAddDoc = addDoc;
    window.firebaseDoc = doc;
    window.firebaseOnSnapshot = onSnapshot;
    window.firebaseUpdateDoc = updateDoc;
    window.firebaseSetDoc = setDoc;
    window.firebaseDeleteDoc = deleteDoc;
    window.firebaseServerTimestamp = serverTimestamp;
    window.firebaseGetDocs = getDocs;
    window.firebaseQuery = query;
    window.firebaseWhere = where;
    window.firebaseOrderBy = orderBy;
    window.firebaseGetDoc = getDoc;

    console.log('Firebase v9+ inicializado');
  </script>

  <!-- Tu l√≥gica -->
  <script src="assets/js/app.js"></script>
</body>
</html>
